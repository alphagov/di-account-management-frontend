{% extends "common/layout/base-page.njk" %}
{% from "common/show-password/macro.njk" import govukInputWithShowPassword %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}

{% macro passwordForm(header, paragraph, backlinkText) %}
    <h1 class="govuk-heading-l govuk-!-margin-top-0 govuk-!-margin-bottom-3">{{header}}</h1>

    <form action="/enter-password" method="post" novalidate>

        <input type="hidden" name="_csrf" value="{{csrfToken}}"/>
        <input type="hidden" name="requestType" value="{{requestType}}"/>

        <p class="govuk-body">{{paragraph}}</p>

        {{ govukInputWithShowPassword({
            label: 'pages.enterPassword.password.label' | translate,
            id: "password",
            errors: errors,
            showSettings: {
                show: 'general.showPassword.show' | translate,
                hide: 'general.showPassword.hide' | translate,
                showFullText: 'general.showPassword.showFullText' | translate,
                hideFullText: 'general.showPassword.hideFullText' | translate,
                announceShown: 'general.showPassword.announceShown' | translate,
                announceHidden: 'general.showPassword.announceHidden' | translate
            }
        })}}

        {{ govukButton({
        "text": button_text|default('general.continue.label' | translate, true),
        "type": "Submit",
        "preventDoubleClick": true
        }) }}

        <p class="govuk-body">
            <a href="/manage-your-account" class="govuk-link" rel="noreferrer noopener">{{backlinkText}}</a>
        </p>

    </form>
{% endmacro %}

{% if requestType == 'changePassword' %}
    {% set pageTitleName = 'pages.enterPassword.changePassword.title' | translate %}
{%  else %}
    {% set pageTitleName = 'pages.enterPassword.title' | translate %}
{% endif %}

{% set backLink = "/manage-your-account" %}

{% block pageContent %}
{% include "common/errors/errorSummary.njk" %}

{% if requestType == 'changeEmail' %}
    {{ passwordForm(
        'pages.enterPassword.changeEmail.title' | translate, 
        'pages.enterPassword.changeEmail.paragraph' | translate, 
        'pages.enterPassword.changeEmail.backLink' | translate) 
    }}
{% endif %}

{% if requestType == 'changePassword' %}
    {{ passwordForm(
        'pages.enterPassword.changePassword.title' | translate, 
        'pages.enterPassword.changePassword.paragraph' | translate, 
        'pages.enterPassword.changePassword.backLink' | translate) 
    }}
{% endif %}

{% if requestType == 'changePhoneNumber' %}
    {{ passwordForm(
        'pages.enterPassword.changePhoneNumber.title' | translate, 
        'pages.enterPassword.changePhoneNumber.paragraph' | translate, 
        'pages.enterPassword.changePhoneNumber.backLink' | translate) 
    }}
{% endif %}

{% if requestType == 'deleteAccount' %}
    {{ passwordForm(
        'pages.enterPassword.deleteAccount.title' | translate, 
        'pages.enterPassword.deleteAccount.paragraph' | translate, 
        'pages.enterPassword.deleteAccount.backLink' | translate) 
    }}
{% endif %}

{% if requestType == 'addMfaMethod' %}
    {{ passwordForm(
        'pages.enterPassword.addMfaMethod.title' | translate, 
        'pages.enterPassword.addMfaMethod.paragraph' | translate, 
        'pages.enterPassword.addMfaMethod.backLink' | translate) 
    }}
{% endif %}

{% endblock %}

{% block scripts %}
    <script type="text/javascript" src="/public/scripts/showPassword.js"></script>
{% endblock %}